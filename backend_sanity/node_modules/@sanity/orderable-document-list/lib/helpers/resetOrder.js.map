{"version":3,"file":"resetOrder.js","names":["client","sanityClient","withConfig","apiVersion","resetOrder","type","query","queryParams","order","ORDER_FIELD_NAME","documents","fetch","length","transaction","aLexoRank","LexoRank","min","index","genNext","patch","set","value","commit","then","update","catch","err"],"sources":["../../src/helpers/resetOrder.js"],"sourcesContent":["import {LexoRank} from 'lexorank'\nimport sanityClient from 'part:@sanity/base/client'\nimport {ORDER_FIELD_NAME} from './constants'\n\nconst client = sanityClient.withConfig({\n  apiVersion: '2021-09-01',\n})\n\n// Function to wipe and re-do ordering with LexoRank\n// Will at least attempt to start with the current order\nexport async function resetOrder(type = ``) {\n  const query = `*[_type == $type]|order(@[$order] asc)._id`\n  const queryParams = {type, order: ORDER_FIELD_NAME}\n  const documents = await client.fetch(query, queryParams)\n\n  if (!documents.length) {\n    return null\n  }\n\n  const transaction = client.transaction()\n  let aLexoRank = LexoRank.min()\n\n  for (let index = 0; index < documents.length; index += 1) {\n    // Generate next rank before even the first document so there's room to move!\n    aLexoRank = aLexoRank.genNext().genNext()\n\n    transaction.patch(documents[index], {\n      set: {[ORDER_FIELD_NAME]: aLexoRank.value},\n    })\n  }\n\n  return transaction\n    .commit()\n    .then((update) => update)\n    .catch((err) => err)\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;;;;;AAEA,IAAMA,MAAM,GAAGC,eAAA,CAAaC,UAAb,CAAwB;EACrCC,UAAU,EAAE;AADyB,CAAxB,CAAf,C,CAIA;AACA;;;SACsBC,U;;;;;kCAAf,aAAqC;IAAA,IAAXC,IAAW;IAC1C,IAAMC,KAAK,+CAAX;IACA,IAAMC,WAAW,GAAG;MAACF,IAAD;MAAOG,KAAK,EAAEC;IAAd,CAApB;IACA,IAAMC,SAAS,SAASV,MAAM,CAACW,KAAP,CAAaL,KAAb,EAAoBC,WAApB,CAAxB;;IAEA,IAAI,CAACG,SAAS,CAACE,MAAf,EAAuB;MACrB,OAAO,IAAP;IACD;;IAED,IAAMC,WAAW,GAAGb,MAAM,CAACa,WAAP,EAApB;;IACA,IAAIC,SAAS,GAAGC,kBAAA,CAASC,GAAT,EAAhB;;IAEA,KAAK,IAAIC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGP,SAAS,CAACE,MAAtC,EAA8CK,KAAK,IAAI,CAAvD,EAA0D;MACxD;MACAH,SAAS,GAAGA,SAAS,CAACI,OAAV,GAAoBA,OAApB,EAAZ;MAEAL,WAAW,CAACM,KAAZ,CAAkBT,SAAS,CAACO,KAAD,CAA3B,EAAoC;QAClCG,GAAG,EAAE;UAAC,CAACX,2BAAD,GAAoBK,SAAS,CAACO;QAA/B;MAD6B,CAApC;IAGD;;IAED,OAAOR,WAAW,CACfS,MADI,GAEJC,IAFI,CAEEC,MAAD,IAAYA,MAFb,EAGJC,KAHI,CAGGC,GAAD,IAASA,GAHX,CAAP;EAID,C"}